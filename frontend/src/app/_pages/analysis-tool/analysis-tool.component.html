<div id="page-analysis-tool">
  <header class="page-title flex items-center">
    <div class="wrapper">
      <div class="hero-container flex items-center justify-between">
        <div class="description flex-auto">
          <div class="title-header f-size-13 line-height-1 f-weight-500 text-transform-uppercase">
            Tools
          </div>
          <h1 class="title">
            Analysis Tool
          </h1>
          <div class="subtitle f-size-20 line-height-1-5 line-height-1">
            Make your own analysis, use our models, visualize the results and download them.
          </div>
          <button mat-raised-button color="primary" class="btn-cta btn-lg"
            (click)="scrollToSection('sectionTypeSelection')">Let&apos;s
            start</button>
        </div>
        <div class="hero-image">
          <img src="assets/img/page/analysis-tool/img-hero.jpg" height="auto" width="650">
        </div>
      </div>
    </div>
    <div class="image-attribution-markup">
      Image by <a
        href="https://www.freepik.com/free-vector/data-inform-illustration-concept_6195525.htm#query=analysis&position=6&from_view=search&track=sph">storyset</a>
      on <a href="https://www.freepik.com/">Freepik</a>
    </div>
  </header>
  <div class="wrapper">
    <section id="section-about">
      <header>
        <div class="title f-size-24 color-tp-title f-weight-500">About Analysis</div>
      </header>
      <br>
      <p class="f-size-16 color-tp-body line-height-1-5">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
        eiusmod tempor
        incididunt ut labore et dolore
        magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      </p>
      <br>
      <div class="f-size-20 color-tp-title f-weight-500">Connectivity Prediction</div>
      <br>
      <p class="f-size-16 color-tp-body line-height-1-5">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
        eiusmod tempor
        incididunt ut labore et dolore
        magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      </p>
      <br>
      <div class="f-size-20 color-tp-title f-weight-500">Employability Impact</div>
      <br>
      <p class="f-size-16 color-tp-body line-height-1-5">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
        eiusmod tempor
        incididunt ut labore et dolore
        magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur.
        Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
      </p>
    </section>
    <section id="section-type-selection" #sectionTypeSelection>
      <header>
        <div class="title f-size-24 color-tp-title f-weight-500">Let&apos;s start</div>
        <div class="subtitle f-size-16 color-tp-body">Choose the type of analysis</div>
      </header>
      <br>
      <div class="flex direction-column items-center justify-between" id="selection-list">
        <mat-card class="selection-item" (click)="onSelectAnalysisTypeClick(1)"
          [ngClass]="{'active': selectedAnalysisType === 1}">
          <mat-icon class="active-icon material-icons color-blue">check_circle</mat-icon>
          <mat-card-title>Connectivity Prediction</mat-card-title>
          <mat-card-subtitle>Analysis</mat-card-subtitle>
          <mat-card-content>
            <p>Lorem ipsum dolor sit amet.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
              ea commodo consequat.</p>
          </mat-card-content>
        </mat-card>
        <mat-card class="selection-item" (click)="onSelectAnalysisTypeClick(2)"
          [ngClass]="{'active': selectedAnalysisType === 2}">
          <mat-icon class="active-icon material-icons color-blue">check_circle</mat-icon>
          <mat-card-title>Employability Impact</mat-card-title>
          <mat-card-subtitle>Analysis</mat-card-subtitle>
          <mat-card-content>
            <p>Lorem ipsum dolor sit amet.</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
              dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
              ea commodo consequat.</p>
          </mat-card-content>
        </mat-card>
      </div>
    </section>
    <section *ngIf="storageTask">
      <div class="storage-task-card"
        [ngClass]="{'pending': storageTask.status === 'PENDING', 'fail': storageTask.status === 'FAILURE', 'started': storageTask.status === 'STARTED', 'success': storageTask.status === 'SUCCESS'}">
        <header class="flex items-center justify-between">
          <div class="color-tp-title flex items-center f-size-14" matTooltip="Last status checked at">
            <mat-icon *ngIf="!loadingPoolTask"
              class="cursor-pointer material-icons-outlined color-tp-body">history</mat-icon>&nbsp;
            <span *ngIf="!loadingPoolTask">{{storageTask.statusCheckedAtString}}</span>&nbsp;<span
              *ngIf="!loadingPoolTask && !this.poolTaskSubscription.closed" class="color-tp-body">(Updating in
              {{statusCheckTimeLeft}}s)</span>
            <div class="flex items-center" *ngIf="loadingPoolTask">
              <mat-spinner [diameter]="20"></mat-spinner>&nbsp;&nbsp;
              <span class="f-size-13 color-tp-body">Updating...</span>
            </div>
          </div>
          <div class="status-label flex items-center pending">
            <div class="label-text f-weight-500">{{storageTask.status}}</div>
            <mat-icon class="label-icon material-icons-outlined"
              *ngIf="storageTask.status === 'FAILURE'">error_outline</mat-icon>
            <mat-icon class="label-icon material-icons-outlined"
              *ngIf="storageTask.status === 'PENDING'">pending</mat-icon>
            <mat-icon class="label-icon material-icons-outlined"
              *ngIf="storageTask.status === 'STARTED'">play_arrow</mat-icon>
            <mat-icon class="label-icon material-icons-outlined"
              *ngIf="storageTask.status === 'SUCCESS'">check_circle</mat-icon>
          </div>
        </header>
        <div class="content">
          <div class="f-size-20 color-tp-title f-weight-500 line-height-1-5">
            <span *ngIf="selectedAnalysisType === 1">Connectivity Prediction Analysis</span>
            <span *ngIf="selectedAnalysisType === 2">Employability Impact Analysis</span>
          </div>
          <div class="f-size-16 color-tp-body">{{storageTask.id}}</div>
          <div class="tag-list flex items-center">
            <div class="tag-item flex items-center" matTooltip="Received at" *ngIf="storageTask.receivedAt">
              <mat-icon class="tag-icon material-icons-outlined color-tp-body f-size-20">manage_history</mat-icon>
              <span class="color-tp-body f-size-13">{{storageTask.receivedAtString}}</span>
            </div>
            <div class="tag-item flex items-center" matTooltip="Started at" *ngIf="storageTask.startedAt">
              <mat-icon class="tag-icon material-icons-outlined color-tp-body f-size-20">play_arrow</mat-icon>
              <span class="color-tp-body f-size-13">{{storageTask.startedAtString}}</span>
            </div>
            <div class="tag-item flex items-center" matTooltip="Success at"
              *ngIf="storageTask.status === 'SUCCESS' && storageTask.successAt">
              <mat-icon class="tag-icon material-icons-outlined color-tp-body f-size-20">done</mat-icon>
              <span class="color-tp-body f-size-13">{{storageTask.successAtString}}</span>
            </div>
            <div class="tag-item flex items-center" matTooltip="Failure at"
              *ngIf="storageTask.status === 'FAILURE' && storageTask.failureAt">
              <mat-icon class="tag-icon material-icons-outlined color-tp-body f-size-20">error_outline</mat-icon>
              <span class="color-tp-body f-size-13">{{storageTask.failureAtString}}</span>
            </div>
          </div>
          <br>
          <div *ngIf="storageTask.statusCheckCode > 200 && storageTask.statusCheckMessage">
            <div class="color-tp-title f-size-14 f-weight-500">Last status message:</div>
            <div class="color-tp-body f-size-14 color-tp-body">{{storageTask.statusCheckMessage}}</div>
          </div>
        </div>
        <footer>
          <button *ngIf="storageTask.status === 'SUCCESS'" (click)="onButtonViewResultsClick()" mat-raised-button>View
            Results</button>
          <button *ngIf="storageTask.status === 'FAILURE'" mat-raised-button>View Errors</button>
          <button *ngIf="storageTask.statusCheckCode > 200 && this.poolTaskSubscription.closed" mat-raised-button
            (click)="onButtonRetryCheckStatusClick()">Retry check status</button>
          <button
            [disabled]="(storageTask.status !== 'SUCCESS' && storageTask.status !== 'FAILURE' && storageTask.statusCheckCode <= 200) || !this.poolTaskSubscription.closed"
            mat-raised-button color="warn" (click)="onButtonRemoveStorageValueClick()"
            matTooltip="Discard and start new analysis">Discard</button>
        </footer>
      </div>
    </section>
    <section id="section-analysis-steps" *ngIf="selectedAnalysisType && !storageTask" #sectionAnalysisSteps>
      <mat-vertical-stepper [linear]="true" #analysisStepper>
        <mat-step [completed]="false">
          <ng-template matStepLabel>Input Data</ng-template>
          <div class="step-inputs-list flex items-stretch">
            <mat-card class="step-input-item" *ngIf="selectedAnalysisType === 1">
              <mat-icon class="cursor-pointer help-icon material-icons color-tp-body"
                matTooltip="View file requirements"
                (click)="onFileRequirementsClick(analysisTypeEnum.School)">help</mat-icon>
              <mat-card-title>Schools</mat-card-title>
              <mat-card-subtitle>input</mat-card-subtitle>
              <mat-card-content>
                <p class="color-tp-body">
                  File containing connectivity data in schools of a country.
                </p>
                <p>Read our <span class="color-blue cursor-pointer"
                    (click)="onFileRequirementsClick(analysisTypeEnum.School)">File
                    Requirements</span> or <a href="/assets/analysis-input-definition/school_template.csv"
                    target="_blank" class="color-blue text-decoration-none">download a CSV
                    Template</a> to get started.</p>
                <div class="file-upload-container direction-column flex items-center" appFileDragAndDrop
                  (fileDropped)="onFileDropped($event, 'schoolFile')" *ngIf="selectedAnalysisType && !schoolFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">file_upload</mat-icon>
                  <p class="f-size-16 color-tp-body">Drag & Drop or <span
                      class="color-blue cursor-pointer text-decoration-none" (click)="fileDropRef.click()">browse</span>
                  </p>
                  <p class="f-size-13 color-tp-label">Supports: CSV</p>
                  <input type="file" #fileDropRef id="fileDropRef" (change)="onFileBrowserHandler($event, 'schoolFile')"
                    accept=".csv" class="file-drop-input" />
                </div>
                <br>
                <div class="file-selected-container flex items-center" *ngIf="schoolFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">description</mat-icon>
                  <div class="flex-auto">
                    <div class="color-tp-title f-size-16 line-height-1-5 f-weight-500">{{schoolFile.name}}</div>
                    <div class="color-tp-body f-size-13">{{schoolFile.size | fileSize}}</div>
                  </div>
                  <button mat-mini-fab color="primary" aria-label="Remove file"
                    (click)="onButtonRemoveFileClick('schoolFile')">
                    <mat-icon class="material-icons-outlined">delete_outline</mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
            <mat-card class="step-input-item" *ngIf="selectedAnalysisType === 2">
              <mat-icon class="cursor-pointer help-icon material-icons color-tp-body"
                matTooltip="View file requirements"
                (click)="onFileRequirementsClick(analysisTypeEnum.SchoolHistory)">help</mat-icon>
              <mat-card-title>School History</mat-card-title>
              <mat-card-subtitle>input</mat-card-subtitle>
              <mat-card-content>
                <p class=" color-tp-body">
                  File containing historical connectivity data in schools of a country.
                </p>
                <p>Read our <span class="color-blue cursor-pointer"
                    (click)="onFileRequirementsClick(analysisTypeEnum.SchoolHistory)">File
                    Requirements</span> or <a href="/assets/analysis-input-definition/school_history_template.csv"
                    target="_blank" class="color-blue text-decoration-none">download a CSV
                    Template</a> to get started.</p>
                <div class="file-upload-container direction-column flex items-center" appFileDragAndDrop
                  (fileDropped)="onFileDropped($event, 'schoolHistoryFile')"
                  *ngIf="selectedAnalysisType && !schoolHistoryFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">file_upload</mat-icon>
                  <p class="f-size-16 color-tp-body">Drag & Drop or <span
                      class="color-blue cursor-pointer text-decoration-none" (click)="fileDropRef.click()">browse</span>
                  </p>
                  <p class="f-size-13 color-tp-label">Supports: CSV</p>
                  <input type="file" #fileDropRef id="fileDropRef"
                    (change)="onFileBrowserHandler($event, 'schoolHistoryFile')" accept=".csv"
                    class="file-drop-input" />
                </div>
                <br>
                <div class="file-selected-container flex items-center" *ngIf="schoolHistoryFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">description</mat-icon>
                  <div class="flex-auto">
                    <div class="color-tp-title f-size-16 line-height-1-5 f-weight-500">{{schoolHistoryFile.name}}</div>
                    <div class="color-tp-body f-size-13">{{schoolHistoryFile.size | fileSize}}</div>
                  </div>
                  <button mat-mini-fab color="primary" aria-label="Remove file"
                    (click)="onButtonRemoveFileClick('schoolHistoryFile')">
                    <mat-icon class="material-icons-outlined">delete_outline</mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
            <mat-card class="step-input-item">
              <mat-icon class="cursor-pointer help-icon material-icons color-tp-body"
                matTooltip="View file requirements"
                (click)="onFileRequirementsClick(analysisTypeEnum.Locality)">help</mat-icon>
              <mat-card-title>Locality</mat-card-title>
              <mat-card-subtitle>input</mat-card-subtitle>
              <mat-card-content>
                <p class=" color-tp-body">
                  File containing location data of a country.
                </p>
                <p>
                  Read our <span class="color-blue cursor-pointer"
                    (click)="onFileRequirementsClick(analysisTypeEnum.Locality)">File
                    Requirements</span> or <a href="/assets/analysis-input-definition/locality_template.csv"
                    target="_blank" class="color-blue text-decoration-none">download a CSV
                    Template</a> to get started.
                </p>
                <div class="file-upload-container direction-column flex items-center" appFileDragAndDrop
                  (fileDropped)="onFileDropped($event, 'localityFile')" *ngIf="selectedAnalysisType && !localityFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">file_upload</mat-icon>
                  <p class="f-size-16 color-tp-body">Drag & Drop or <span
                      class="color-blue cursor-pointer text-decoration-none" (click)="fileDropRef.click()">browse</span>
                  </p>
                  <p class="f-size-13 color-tp-label">Supports: CSV</p>
                  <input type="file" #fileDropRef id="fileDropRef"
                    (change)="onFileBrowserHandler($event, 'localityFile')" accept=".csv" class="file-drop-input" />
                </div>
                <br>
                <div class="file-selected-container flex items-center" *ngIf="localityFile">
                  <mat-icon class="material-icons-outlined f-size-48 color-tp-body">description</mat-icon>
                  <div class="flex-auto">
                    <div class="color-tp-title f-size-16 line-height-1-5 f-weight-500">{{localityFile.name}}</div>
                    <div class="color-tp-body f-size-13">{{localityFile.size | fileSize}}</div>
                  </div>
                  <button mat-mini-fab color="primary" aria-label="Remove file"
                    (click)="onButtonRemoveFileClick('localityFile')">
                    <mat-icon class="material-icons-outlined">delete_outline</mat-icon>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
          <div class="step-action-container">
            <button mat-raised-button color="primary" (click)="onButtonNextClick()"
              [disabled]="!schoolFile || !localityFile" *ngIf="selectedAnalysisType === 1">Next</button>
            <button mat-raised-button color="primary" (click)="onButtonNextClick()"
              [disabled]="!localityFile && !schoolHistoryFile" *ngIf="selectedAnalysisType === 2">Next</button>
          </div>
        </mat-step>
        <mat-step [completed]="false">
          <ng-template matStepLabel>Data Validation</ng-template>
          <p>Data validation summary goes here</p>
          <button mat-raised-button color="primary" (click)="onButtonNextClick()">Next</button>
        </mat-step>
        <mat-step [completed]="false">
          <ng-template matStepLabel>Execute</ng-template>
          <div>
            <p>If you are ready, click the button below to start analysis processing</p>
            <button mat-raised-button color="warn" (click)="onButtonStartAnalysisClick()"
              [disabled]="loadingStartTask">Start Analysis</button>
          </div>
          <br>
          <div class="upload-file-progrees" *ngIf="loadingStartTask">
            <p>Upload Progress: {{progress}}%</p>
            <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
          </div>
        </mat-step>
      </mat-vertical-stepper>
    </section>
  </div>
</div>
<!-- FOOTER -->
<app-page-footer [isCompressed]="true"></app-page-footer>